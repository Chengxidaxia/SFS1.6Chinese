<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XUnity.AutoTranslator å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #2a5298);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            margin-top: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        h1 {
            font-weight: 700;
            font-size: 2.2rem;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff8a00, #e52e71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: #e0e0e0;
            max-width: 600px;
            margin: 0 auto 20px;
            line-height: 1.6;
        }
        
        .card {
            margin-bottom: 25px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        h2 {
            margin-bottom: 20px;
            font-size: 1.4rem;
            color: #a8d8ff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            font-size: 1.1rem;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        select option {
            background: #2a5298;
            color: white;
        }
        
        /* é€‰ä¸­çš„é€‰é¡¹æ ·å¼ */
        select option:checked {
            background: #4a9eff;
            color: white;
        }
        
        /* æœªé€‰ä¸­çš„é€‰é¡¹æ ·å¼ */
        select option:not(:checked) {
            background: #3a4a7a;
            color: #ccc;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 2px rgba(100, 150, 255, 0.5);
        }
        
        .color-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
        }
        
        #colorPicker {
            width: 70px;
            height: 50px;
            border: none;
            border-radius: 8px;
            background: transparent;
            cursor: pointer;
        }
        
        .color-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .color-value {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 1.1rem;
        }
        
        .preview-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .preview-section {
                grid-template-columns: 1fr;
            }
        }
        
        .preview-box {
            min-height: 120px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            word-break: break-all;
            text-align: center;
        }
        
        .preview-title {
            font-size: 1rem;
            color: #a8d8ff;
            margin-bottom: 10px;
        }
        
        .styled-content {
            font-size: 1.6rem;
            font-weight: bold;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            width: 100%;
            text-align: center;
            line-height: 1.5;
        }
        
        .code-preview {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            width: 100%;
            font-size: 1.1rem;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        button {
            padding: 14px 25px;
            border: none;
            border-radius: 10px;
            background: #4a9eff;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        button:hover {
            background: #2d8cff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .instructions {
            margin-top: 30px;
        }
        
        .instructions h3 {
            margin-bottom: 15px;
            color: #a8d8ff;
            font-size: 1.3rem;
        }
        
        .instructions ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .example {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 15px;
            border-radius: 8px;
            display: inline-block;
            margin-top: 8px;
            font-size: 1.1rem;
        }
        
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            font-weight: 500;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.3s, fadeOut 0.3s 2.7s;
        }
        
        .message.success {
            background: #4caf50;
            color: white;
        }
        
        .message.error {
            background: #f44336;
            color: white;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
        
        .plugin-info {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            text-align: center;
        }
        
        .tag-selector {
            display: none;
            margin-bottom: 20px;
        }
        
        .tag-info {
            font-size: 0.9rem;
            color: #a8d8ff;
            margin-top: 10px;
            text-align: center;
        }
        
        .no-color-section {
            display: none;
            margin-top: 15px;
            text-align: center;
            font-size: 0.9rem;
            color: #a8d8ff;
        }
        
        .entry-selector {
            margin-bottom: 20px;
        }
        
        .segment-selector {
            margin-bottom: 20px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .download-section {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .download-button {
            background: linear-gradient(135deg, #ff8a00, #e52e71);
            font-size: 1.2rem;
            padding: 16px 30px;
            margin-top: 0;
            max-width: 300px;
            margin: 0 auto;
        }
        
        .download-button:hover {
            background: linear-gradient(135deg, #e57a00, #d41e61);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .add-color-section {
            text-align: center;
            margin-top: 15px;
        }
        
        .add-color-button {
            background: linear-gradient(135deg, #00c853, #00e676);
            font-size: 1rem;
            padding: 12px 20px;
            max-width: 250px;
            margin: 0 auto;
        }
        
        .add-color-button:hover {
            background: linear-gradient(135deg, #00b34a, #00d46a);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>XUnity.AutoTranslator å¯Œæ–‡æœ¬ç¼–è¾‘å™¨</h1>
            <p class="subtitle">æ”¯æŒå•è¡Œå†…å¤šä¸ªcoloræ ‡ç­¾çš„å¯Œæ–‡æœ¬æ ‡è®°ç¼–è¾‘å™¨</p>
        </header>
        
        <!-- ä¸‹è½½æŒ‰é’®éƒ¨åˆ† - ç§»åˆ°æœ€ä¸Šæ–¹ -->
        <div class="download-section">
            <button id="downloadButton" class="download-button">
                <span class="icon">â¬‡ï¸</span> ç‚¹å‡»ä¸‹è½½SFS1.6æ±‰åŒ–ç‰ˆ
            </button>
        </div>
        
        <div class="card">
            <h2><span class="icon">ğŸ“¥</span> è¾“å…¥XUnityæ ¼å¼æ–‡æœ¬</h2>
            <div class="input-group">
                <label for="originalText">è¯·è¾“å…¥XUnity.AutoTranslatoræ ¼å¼çš„æ–‡æœ¬ï¼š</label>
                <textarea id="originalText" rows="4" placeholder="ä¾‹å¦‚ï¼š
system_message=<color\=#FF0000>ç³»ç»Ÿ</color><color\=#00FF00>æç¤º</color>
dialog_title=<color\=#FF5733>å¯¹è¯æ ‡é¢˜</color>
no_color_message=æ™®é€šæ–‡æœ¬ï¼ˆæ— é¢œè‰²æ ‡ç­¾ï¼‰"></textarea>
            </div>
            <button id="parseButton">
                <span class="icon">ğŸ”</span> è§£ææ–‡æœ¬
            </button>
        </div>
        
        <div class="card">
            <h2><span class="icon">âœï¸</span> ç¼–è¾‘å†…å®¹</h2>
            
            <div class="entry-selector">
                <label for="entrySelect">é€‰æ‹©è¦ç¼–è¾‘çš„æ¡ç›®ï¼š</label>
                <select id="entrySelect">
                    <option value="0">æ¡ç›® 1</option>
                </select>
            </div>
            
            <div class="segment-selector hidden" id="segmentSelector">
                <label for="segmentSelect">é€‰æ‹©è¦ç¼–è¾‘çš„ç‰‡æ®µï¼š</label>
                <select id="segmentSelect">
                    <option value="0">ç‰‡æ®µ 1</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="contentInput">ç¼–è¾‘æ–‡æœ¬å†…å®¹ï¼š</label>
                <textarea id="contentInput" rows="3" placeholder="è¾“å…¥æ–°çš„æ–‡æœ¬å†…å®¹"></textarea>
            </div>
            
            <div class="input-group" id="colorSection">
                <label>é€‰æ‹©æ–‡æœ¬é¢œè‰²ï¼š</label>
                <div class="color-section">
                    <input type="color" id="colorPicker" value="#FFFFFF">
                    <div class="color-info">
                        <div class="color-value" id="colorValue">#FFFFFF</div>
                        <small>ç‚¹å‡»è‰²å—é€‰æ‹©é¢œè‰²</small>
                    </div>
                </div>
            </div>
            
            <div class="no-color-section" id="noColorSection">
                å½“å‰æ–‡æœ¬æ²¡æœ‰coloræ ‡ç­¾ï¼Œæ¸¸æˆå†…å°†æ˜¾ç¤ºé»˜è®¤ç™½è‰²
            </div>
            
            <!-- æ·»åŠ é¢œè‰²æ ‡ç­¾æŒ‰é’® -->
            <div class="add-color-section hidden" id="addColorSection">
                <button id="addColorButton" class="add-color-button">
                    <span class="icon">ğŸ¨</span> æ·»åŠ é¢œè‰²æ ‡ç­¾
                </button>
            </div>
            
            <div class="tag-info" id="tagInfo">
                å½“å‰ç¼–è¾‘: æ¡ç›® 1
            </div>
        </div>
        
        <div class="card">
            <h2><span class="icon">ğŸ‘ï¸</span> é¢„è§ˆæ•ˆæœ</h2>
            <div class="preview-section">
                <div class="preview-box">
                    <div class="preview-title">æ–‡æœ¬æ•ˆæœé¢„è§ˆ</div>
                    <div id="styledPreview" class="styled-content">é¢„è§ˆå°†åœ¨æ­¤æ˜¾ç¤º</div>
                </div>
                <div class="preview-box">
                    <div class="preview-title">XUnity.AutoTranslatoræ ¼å¼</div>
                    <div id="codePreview" class="code-preview">ä»£ç å°†åœ¨æ­¤æ˜¾ç¤º</div>
                </div>
            </div>
        </div>
        
        <div class="card instructions">
            <h3><span class="icon">â„¹ï¸</span> ä½¿ç”¨è¯´æ˜</h3>
            <ul>
                <li>æ­¤ç¼–è¾‘å™¨ä¸“ä¸ºXUnity.AutoTranslatoræ’ä»¶è®¾è®¡ï¼Œæ”¯æŒå•è¡Œå†…å¤šä¸ªcoloræ ‡ç­¾</li>
                <li>åœ¨"è¾“å…¥XUnityæ ¼å¼æ–‡æœ¬"åŒºåŸŸè¾“å…¥XUnity.AutoTranslatoræ ¼å¼çš„æ–‡æœ¬ï¼ˆæ”¯æŒå¤šè¡Œï¼‰</li>
                <li>æ”¯æŒå•è¡Œå†…å¤šä¸ªcoloræ ‡ç­¾ï¼Œä¾‹å¦‚ï¼š<code>text=&lt;color\=#FF0000&gt;çº¢è‰²&lt;/color&gt;&lt;color\=#00FF00&gt;ç»¿è‰²&lt;/color&gt;</code></li>
                <li>æ–‡æœ¬å¯ä»¥æ²¡æœ‰coloræ ‡ç­¾ï¼Œæ¸¸æˆå†…å°†æ˜¾ç¤ºé»˜è®¤ç™½è‰²</li>
                <li>ç‚¹å‡»"è§£ææ–‡æœ¬"æŒ‰é’®æå–æ‰€æœ‰æ¡ç›®å’Œç‰‡æ®µ</li>
                <li>ä½¿ç”¨æ¡ç›®é€‰æ‹©å™¨é€‰æ‹©è¦ç¼–è¾‘çš„æ¡ç›®</li>
                <li>å½“æ¡ç›®æœ‰å¤šä¸ªcoloræ ‡ç­¾æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç‰‡æ®µé€‰æ‹©å™¨é€‰æ‹©è¦ç¼–è¾‘çš„ç‰‡æ®µ</li>
                <li>åœ¨"ç¼–è¾‘å†…å®¹"åŒºåŸŸä¿®æ”¹æ–‡æœ¬å†…å®¹</li>
                <li>ä½¿ç”¨é¢œè‰²é€‰æ‹©å™¨æ›´æ”¹æ–‡æœ¬é¢œè‰²</li>
                <li>å¯¹äºæ²¡æœ‰coloræ ‡ç­¾çš„æ–‡æœ¬ï¼Œå¯ä»¥ä½¿ç”¨"æ·»åŠ é¢œè‰²æ ‡ç­¾"æŒ‰é’®ä¸ºå…¶æ·»åŠ é¢œè‰²</li>
                <li>é¢„è§ˆåŒºåŸŸå°†å®æ—¶æ˜¾ç¤ºä¿®æ”¹åçš„æ•ˆæœå’ŒXUnityæ ¼å¼ä»£ç </li>
            </ul>
            <div class="plugin-info">
                <strong>å…³äºXUnity.AutoTranslatorï¼š</strong>è¿™æ˜¯ä¸€æ¬¾Unityæ¸¸æˆç¿»è¯‘æ’ä»¶ï¼Œæ”¯æŒä½¿ç”¨å¯Œæ–‡æœ¬æ ‡è®°ä¸ºæ¸¸æˆæ–‡æœ¬æ·»åŠ é¢œè‰²å’Œæ ·å¼ã€‚ä½¿ç”¨<code>&lt;color\=#RRGGBB&gt;æ–‡æœ¬&lt;/color&gt;</code>æ ¼å¼å¯ä»¥æ”¹å˜æ–‡æœ¬é¢œè‰²ã€‚æ²¡æœ‰coloræ ‡ç­¾æ—¶æ¸¸æˆå†…æ˜¾ç¤ºé»˜è®¤ç™½è‰²ã€‚
            </div>
            <p>ç¤ºä¾‹è¾“å…¥: 
                <span class="example">system_message=&lt;color\=#FF0000&gt;ç³»ç»Ÿ&lt;/color&gt;&lt;color\=#00FF00&gt;æç¤º&lt;/color&gt;</span><br>
                <span class="example">no_color=æ™®é€šæ–‡æœ¬ï¼ˆæ— é¢œè‰²æ ‡ç­¾ï¼‰</span>
            </p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // è·å–DOMå…ƒç´ 
            const originalTextInput = document.getElementById('originalText');
            const parseButton = document.getElementById('parseButton');
            const entrySelect = document.getElementById('entrySelect');
            const segmentSelector = document.getElementById('segmentSelector');
            const segmentSelect = document.getElementById('segmentSelect');
            const tagInfo = document.getElementById('tagInfo');
            const contentInput = document.getElementById('contentInput');
            const colorSection = document.getElementById('colorSection');
            const colorPicker = document.getElementById('colorPicker');
            const colorValue = document.getElementById('colorValue');
            const noColorSection = document.getElementById('noColorSection');
            const addColorSection = document.getElementById('addColorSection');
            const addColorButton = document.getElementById('addColorButton');
            const styledPreview = document.getElementById('styledPreview');
            const codePreview = document.getElementById('codePreview');
            const downloadButton = document.getElementById('downloadButton');
            
            // å­˜å‚¨è§£æç»“æœ
            let parsedEntries = [];
            let currentEntryIndex = 0;
            let currentSegmentIndex = 0;
            
            // è§£ææ–‡æœ¬
            parseButton.addEventListener('click', function() {
                const text = originalTextInput.value.trim();
                
                // æŒ‰è¡Œåˆ†å‰²æ–‡æœ¬
                const lines = text.split('\n');
                parsedEntries = [];
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    // åˆ†ç¦»é”®å’Œå€¼
                    const equalsIndex = line.indexOf('=');
                    if (equalsIndex === -1) continue;
                    
                    const key = line.substring(0, equalsIndex);
                    const value = line.substring(equalsIndex + 1);
                    
                    // æ£€æµ‹æ˜¯å¦æœ‰coloræ ‡ç­¾
                    const hasColorTag = value.includes('<color\\=') && value.includes('</color>');
                    
                    if (hasColorTag) {
                        // è§£ææ‰€æœ‰coloræ ‡ç­¾
                        const segments = [];
                        let remainingValue = value;
                        
                        // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ‰€æœ‰coloræ ‡ç­¾
                        const colorRegex = /<color\\=([^>]+)>([^<]*)<\/color>/g;
                        let match;
                        let lastIndex = 0;
                        
                        while ((match = colorRegex.exec(value)) !== null) {
                            // æ·»åŠ åŒ¹é…å‰çš„æ–‡æœ¬ï¼ˆå¦‚æœæœ‰ï¼‰
                            if (match.index > lastIndex) {
                                segments.push({
                                    type: 'text',
                                    content: value.substring(lastIndex, match.index)
                                });
                            }
                            
                            // æ·»åŠ coloræ ‡ç­¾
                            segments.push({
                                type: 'color',
                                color: match[1],
                                content: match[2]
                            });
                            
                            lastIndex = match.index + match[0].length;
                        }
                        
                        // æ·»åŠ å‰©ä½™çš„æ–‡æœ¬ï¼ˆå¦‚æœæœ‰ï¼‰
                        if (lastIndex < value.length) {
                            segments.push({
                                type: 'text',
                                content: value.substring(lastIndex)
                            });
                        }
                        
                        parsedEntries.push({
                            key: key,
                            segments: segments,
                            hasColorTag: true,
                            originalValue: value
                        });
                    } else {
                        // æ²¡æœ‰coloræ ‡ç­¾
                        parsedEntries.push({
                            key: key,
                            segments: [{
                                type: 'text',
                                content: value
                            }],
                            hasColorTag: false,
                            originalValue: value
                        });
                    }
                }
                
                if (parsedEntries.length > 0) {
                    // æ›´æ–°æ¡ç›®é€‰æ‹©å™¨
                    updateEntrySelector();
                    
                    // æ›´æ–°ç‰‡æ®µé€‰æ‹©å™¨
                    updateSegmentSelector();
                    
                    // è®¾ç½®å½“å‰ç¼–è¾‘çš„æ¡ç›®å’Œç‰‡æ®µ
                    currentEntryIndex = 0;
                    currentSegmentIndex = 0;
                    updateEditor();
                    
                    // æ›´æ–°é¢„è§ˆ
                    updatePreview();
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showMessage(`æˆåŠŸè§£æ ${parsedEntries.length} ä¸ªæ¡ç›®ï¼`, 'success');
                } else {
                    showMessage('æ ¼å¼é”™è¯¯ï¼è¯·ç¡®ä¿è¾“å…¥ç¬¦åˆ XUnity.AutoTranslator æ ¼å¼', 'error');
                }
            });
            
            // ä¸‹è½½æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            downloadButton.addEventListener('click', function() {
                window.open('https://github.com/Chengxidaxia/SFS1.6Chinese/releases/latest', '_blank');
            });
            
            // æ·»åŠ é¢œè‰²æ ‡ç­¾æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            addColorButton.addEventListener('click', function() {
                const currentEntry = parsedEntries[currentEntryIndex];
                if (!currentEntry) return;
                
                // è·å–å½“å‰æ–‡æœ¬å†…å®¹
                const content = contentInput.value;
                
                // ä½¿ç”¨å½“å‰é¢œè‰²é€‰æ‹©å™¨çš„é¢œè‰²
                const color = colorPicker.value;
                
                // æ›´æ–°æ¡ç›®æ•°æ®ç»“æ„
                currentEntry.hasColorTag = true;
                currentEntry.originalValue = `<color\\=${color}>${content}</color>`;
                currentEntry.segments = [{
                    type: 'color',
                    color: color,
                    content: content
                }];
                
                // æ›´æ–°ç¼–è¾‘å™¨
                updateEditor();
                
                // æ›´æ–°é¢„è§ˆ
                updatePreview();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showMessage('å·²æ·»åŠ é¢œè‰²æ ‡ç­¾ï¼', 'success');
            });
            
            // æ›´æ–°æ¡ç›®é€‰æ‹©å™¨
            function updateEntrySelector() {
                entrySelect.innerHTML = '';
                
                for (let i = 0; i < parsedEntries.length; i++) {
                    const entry = parsedEntries[i];
                    const option = document.createElement('option');
                    option.value = i;
                    
                    // æ˜¾ç¤ºæ¡ç›®é”®åå’Œæ˜¯å¦æœ‰é¢œè‰²æ ‡ç­¾
                    let colorInfo = entry.hasColorTag ? 'æœ‰é¢œè‰²' : 'æ— é¢œè‰²';
                    option.textContent = `${entry.key} (${colorInfo})`;
                    entrySelect.appendChild(option);
                }
            }
            
            // æ›´æ–°ç‰‡æ®µé€‰æ‹©å™¨
            function updateSegmentSelector() {
                segmentSelect.innerHTML = '';
                
                const currentEntry = parsedEntries[currentEntryIndex];
                if (!currentEntry) return;
                
                const segments = currentEntry.segments;
                
                // åªæœ‰å½“æœ‰å¤šä¸ªç‰‡æ®µæ—¶æ‰æ˜¾ç¤ºç‰‡æ®µé€‰æ‹©å™¨
                if (segments.length > 1) {
                    segmentSelector.classList.remove('hidden');
                    
                    for (let i = 0; i < segments.length; i++) {
                        const segment = segments[i];
                        const option = document.createElement('option');
                        option.value = i;
                        
                        // ä½¿ç”¨å®é™…æ–‡æœ¬å†…å®¹ä½œä¸ºé€‰é¡¹æ–‡æœ¬
                        let displayText = segment.content;
                        
                        // å¦‚æœæ–‡æœ¬è¿‡é•¿ï¼Œæˆªæ–­æ˜¾ç¤º
                        if (displayText.length > 20) {
                            displayText = displayText.substring(0, 20) + '...';
                        }
                        
                        // å¦‚æœæ˜¯ç©ºæ–‡æœ¬ï¼Œæ˜¾ç¤ºå ä½ç¬¦
                        if (displayText === '') {
                            displayText = '(ç©ºæ–‡æœ¬)';
                        }
                        
                        // æ·»åŠ ç±»å‹æ ‡è¯†
                        if (segment.type === 'color') {
                            option.textContent = `ğŸ¨ ${displayText}`;
                        } else {
                            option.textContent = `ğŸ“ ${displayText}`;
                        }
                        
                        // æ·»åŠ å®Œæ•´æ–‡æœ¬ä½œä¸ºæç¤º
                        option.title = segment.content;
                        
                        segmentSelect.appendChild(option);
                    }
                } else {
                    segmentSelector.classList.add('hidden');
                }
            }
            
            // æ¡ç›®é€‰æ‹©å™¨å˜åŒ–äº‹ä»¶
            entrySelect.addEventListener('change', function() {
                currentEntryIndex = parseInt(this.value);
                currentSegmentIndex = 0;
                updateSegmentSelector();
                updateEditor();
                updatePreview();
            });
            
            // ç‰‡æ®µé€‰æ‹©å™¨å˜åŒ–äº‹ä»¶
            segmentSelect.addEventListener('change', function() {
                currentSegmentIndex = parseInt(this.value);
                updateEditor();
                updatePreview();
            });
            
            // æ›´æ–°ç¼–è¾‘å™¨å†…å®¹
            function updateEditor() {
                if (parsedEntries.length > currentEntryIndex) {
                    const currentEntry = parsedEntries[currentEntryIndex];
                    const segments = currentEntry.segments;
                    
                    if (segments.length > currentSegmentIndex) {
                        const currentSegment = segments[currentSegmentIndex];
                        
                        // æ›´æ–°å†…å®¹è¾“å…¥æ¡†
                        contentInput.value = currentSegment.content;
                        
                        // æ ¹æ®ç‰‡æ®µç±»å‹æ˜¾ç¤º/éšè—é¢œè‰²é€‰æ‹©å™¨
                        if (currentSegment.type === 'color') {
                            colorSection.style.display = 'block';
                            noColorSection.style.display = 'none';
                            addColorSection.classList.add('hidden');
                            
                            // æ›´æ–°é¢œè‰²é€‰æ‹©å™¨
                            if (isValidColor(currentSegment.color)) {
                                colorPicker.value = currentSegment.color;
                                colorValue.textContent = currentSegment.color;
                            }
                        } else {
                            colorSection.style.display = 'none';
                            noColorSection.style.display = 'block';
                            addColorSection.classList.remove('hidden');
                        }
                        
                        // æ›´æ–°æ ‡ç­¾ä¿¡æ¯
                        const segmentType = currentSegment.type === 'color' ? 'é¢œè‰²ç‰‡æ®µ' : 'æ–‡æœ¬ç‰‡æ®µ';
                        tagInfo.textContent = `å½“å‰ç¼–è¾‘: ${currentEntry.key} - ${segmentType} (${currentSegment.content})`;
                    }
                }
            }
            
            // æ›´æ–°é¢„è§ˆ
            function updatePreview() {
                // æ›´æ–°æ ·å¼é¢„è§ˆ - æ˜¾ç¤ºæ•´ä¸ªæ¡ç›®çš„æ•ˆæœ
                if (parsedEntries.length > currentEntryIndex) {
                    const currentEntry = parsedEntries[currentEntryIndex];
                    let styledHtml = '';
                    
                    for (let i = 0; i < currentEntry.segments.length; i++) {
                        const segment = currentEntry.segments[i];
                        
                        // å¦‚æœæ˜¯å½“å‰ç¼–è¾‘çš„ç‰‡æ®µï¼Œä½¿ç”¨ç¼–è¾‘å™¨çš„å€¼
                        const content = (i === currentSegmentIndex) ? contentInput.value : segment.content;
                        
                        if (segment.type === 'color') {
                            // å¦‚æœæ˜¯å½“å‰ç¼–è¾‘çš„ç‰‡æ®µï¼Œä½¿ç”¨ç¼–è¾‘å™¨çš„é¢œè‰²
                            const color = (i === currentSegmentIndex) ? colorPicker.value : segment.color;
                            styledHtml += `<span style="color: ${color}">${content}</span>`;
                        } else {
                            styledHtml += `<span>${content}</span>`;
                        }
                    }
                    
                    styledPreview.innerHTML = styledHtml;
                }
                
                // æ›´æ–°ä»£ç é¢„è§ˆ - æ˜¾ç¤ºæ‰€æœ‰æ¡ç›®
                let fullCode = '';
                for (let i = 0; i < parsedEntries.length; i++) {
                    const entry = parsedEntries[i];
                    
                    // å¦‚æœæ˜¯å½“å‰ç¼–è¾‘çš„æ¡ç›®ï¼Œä½¿ç”¨ç¼–è¾‘å™¨çš„å€¼
                    if (i === currentEntryIndex) {
                        let entryValue = '';
                        
                        for (let j = 0; j < entry.segments.length; j++) {
                            const segment = entry.segments[j];
                            
                            // å¦‚æœæ˜¯å½“å‰ç¼–è¾‘çš„ç‰‡æ®µï¼Œä½¿ç”¨ç¼–è¾‘å™¨çš„å€¼
                            const content = (j === currentSegmentIndex) ? contentInput.value : segment.content;
                            
                            if (segment.type === 'color') {
                                // å¦‚æœæ˜¯å½“å‰ç¼–è¾‘çš„ç‰‡æ®µï¼Œä½¿ç”¨ç¼–è¾‘å™¨çš„é¢œè‰²
                                const color = (j === currentSegmentIndex) ? colorPicker.value : segment.color;
                                entryValue += `<color\\=${color}>${content}</color>`;
                            } else {
                                entryValue += content;
                            }
                        }
                        
                        fullCode += `${entry.key}=${entryValue}\n`;
                    } else {
                        // å…¶ä»–æ¡ç›®ä¿æŒåŸæ ·
                        fullCode += `${entry.key}=${entry.originalValue}\n`;
                    }
                }
                codePreview.textContent = fullCode.trim();
            }
            
            // ç›‘å¬å†…å®¹å˜åŒ–
            contentInput.addEventListener('input', updatePreview);
            
            // ç›‘å¬é¢œè‰²å˜åŒ–
            colorPicker.addEventListener('input', function() {
                colorValue.textContent = colorPicker.value;
                updatePreview();
            });
            
            // è¾…åŠ©å‡½æ•°ï¼šéªŒè¯é¢œè‰²æ ¼å¼
            function isValidColor(color) {
                const s = new Option().style;
                s.color = color;
                return s.color !== '';
            }
            
            // æ˜¾ç¤ºæ¶ˆæ¯
            function showMessage(message, type) {
                // ç§»é™¤ç°æœ‰æ¶ˆæ¯
                const existingMessage = document.querySelector('.message');
                if (existingMessage) {
                    existingMessage.remove();
                }
                
                // åˆ›å»ºæ–°æ¶ˆæ¯
                const messageEl = document.createElement('div');
                messageEl.textContent = message;
                messageEl.className = `message ${type}`;
                
                document.body.appendChild(messageEl);
                
                // 3ç§’åè‡ªåŠ¨ç§»é™¤
                setTimeout(() => {
                    if (messageEl.parentNode) {
                        messageEl.parentNode.removeChild(messageEl);
                    }
                }, 3000);
            }
            
            // åˆå§‹åŒ–ç¤ºä¾‹
            originalTextInput.value = "system_message=<color\\=#FF0000>ç³»ç»Ÿ</color><color\\=#00FF00>æç¤º</color>\ndialog_title=<color\\=#FF5733>å¯¹è¯æ ‡é¢˜</color>\nno_color_message=æ™®é€šæ–‡æœ¬ï¼ˆæ— é¢œè‰²æ ‡ç­¾ï¼‰";
            parseButton.click();
        });
    </script>
</body>
</html>
